<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å¤§ä¼šæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ </title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .tabs { display: flex; margin-bottom: 10px; }
  .tab-button {
    flex: 1;
    padding: 10px;
    cursor: pointer;
    border: 1px solid #ccc;
    background: #f5f5f5;
  }
  .tab-button.active { background: #4caf50; color: #fff; font-weight: bold; }
  .form-section { margin: 15px 0; }
  .winner-block { margin: 8px 0; padding: 8px; border: 1px solid #ccc; border-radius: 6px; background: #fafafa; }
  label { display: inline-block; width: 80px; }
  input, select { margin: 5px 0; }
  .container { display: flex; gap: 20px; }
  #preview { width: 100%; height: 300px; white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; background: #fafafa; }
  #tweetButton {
    background: #1da1f2; color: #fff; border: none;
    padding: 10px 20px; border-radius: 6px; cursor: pointer;
    font-size: 16px; margin-top: 10px;
  }
  #tweetButton:hover { background: #0d8ddb; }
</style>
</head>
<body>

<h1>å¤§ä¼šæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ </h1>

<div class="tabs">
  <button class="tab-button active" data-title="ãƒã‚±ãƒ¢ãƒ³">ãƒã‚±ãƒ¢ãƒ³</button>
  <button class="tab-button" data-title="éŠæˆ¯ç‹">éŠæˆ¯ç‹</button>
  <button class="tab-button" data-title="ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹">ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹</button>
</div>

<div class="container">
  <div style="flex:1;">
    <div class="form-section">
      <label for="eventName">å¤§ä¼šå:</label>
      <select id="eventName"></select>
    </div>

    <div class="form-section">
      <label for="participants">å‚åŠ äººæ•°:</label>
      <input type="number" id="participants" min="1" placeholder="ä¾‹: 54">
    </div>

    <div class="form-section">
      <label for="formatSelect">å½¢å¼:</label>
      <select id="formatSelect">
        <option value="winner">å…¥è³è€…</option>
        <option value="rank">é †ä½</option>
      </select>
    </div>

    <div class="form-section">
      <h3>å…¥è³è€…æƒ…å ±</h3>
      <div class="winner-block">
        <label>å…¥è³è€…1:</label>
        <input type="text" id="winner1" placeholder="åå‰">
        <input type="text" id="deck1" placeholder="ãƒ‡ãƒƒã‚­å">
      </div>
      <div class="winner-block">
        <label>å…¥è³è€…2:</label>
        <input type="text" id="winner2" placeholder="åå‰">
        <input type="text" id="deck2" placeholder="ãƒ‡ãƒƒã‚­å">
      </div>
      <div class="winner-block">
        <label>å…¥è³è€…3:</label>
        <input type="text" id="winner3" placeholder="åå‰">
        <input type="text" id="deck3" placeholder="ãƒ‡ãƒƒã‚­å">
      </div>
      <div class="winner-block">
        <label>å…¥è³è€…4:</label>
        <input type="text" id="winner4" placeholder="åå‰">
        <input type="text" id="deck4" placeholder="ãƒ‡ãƒƒã‚­å">
      </div>
    </div>

    <button id="tweetButton">Xï¼ˆæ—§Twitterï¼‰ã§æŠ•ç¨¿</button>
  </div>

  <div style="flex:1;">
    <h3>æ–‡ç« ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
    <div id="preview"></div>
  </div>
</div>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz05JZzeCm16fWkLyoTdK-W50n5aBViJPgYAy19O4ZZw-lKhZ6GkWWE0EQoQ7oKFwZw/exec";

let templateData = {}; // {ã‚¿ã‚¤ãƒˆãƒ«: {å¤§ä¼šå: {é–‹å§‹æ–‡, çµ‚äº†æ–‡}}}

async function loadTemplateData() {
  try {
    const res = await fetch(SHEET_URL);
    const json = await res.json();
    json.forEach(row => {
      const title = row["ã‚¿ã‚¤ãƒˆãƒ«ã€€"].trim();
      const event = row["å¤§ä¼šå"];
      const start = row["é–‹å§‹æ–‡"];
      const end = row["çµ‚äº†æ–‡"];
      if (!templateData[title]) templateData[title] = {};
      templateData[title][event] = { start, end };
    });
    updateEventOptions("ãƒã‚±ãƒ¢ãƒ³");
    updatePreview();
  } catch (err) {
    console.error("ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—:", err);
  }
}

const tabButtons = document.querySelectorAll(".tab-button");
const eventSelect = document.getElementById("eventName");
const participantsInput = document.getElementById("participants");
const formatSelect = document.getElementById("formatSelect");
const previewDiv = document.getElementById("preview");
const tweetButton = document.getElementById("tweetButton");
const winners = [
  {name: document.getElementById("winner1"), deck: document.getElementById("deck1")},
  {name: document.getElementById("winner2"), deck: document.getElementById("deck2")},
  {name: document.getElementById("winner3"), deck: document.getElementById("deck3")},
  {name: document.getElementById("winner4"), deck: document.getElementById("deck4")},
];

function updateEventOptions(title){
  eventSelect.innerHTML = "";
  const events = Object.keys(templateData[title] || {});
  events.forEach(ev=>{
    const opt = document.createElement("option");
    opt.textContent = ev;
    eventSelect.appendChild(opt);
  });
}

tabButtons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    tabButtons.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    updateEventOptions(btn.textContent);
    updatePreview();
  });
});

function updatePreview(){
  const title = document.querySelector(".tab-button.active").textContent;
  const event = eventSelect.value || "<æœªé¸æŠ>";
  const participants = participantsInput.value || "<æœªå…¥åŠ›>";
  const format = formatSelect.value;

  let startTemplate = templateData[title]?.[event]?.start || "";
  startTemplate = startTemplate.replace("{participants}", participants);

  let endTemplate = templateData[title]?.[event]?.end || "";

  let middle = "";
  const enteredWinners = winners.filter(w=> w.name.value);
  if(format === "winner"){
    if(enteredWinners.length>0) middle += "å…¥è³è€…ã¯ï½\n";
    enteredWinners.forEach(w=>{
      const name = w.name.value;
      const deck = w.deck.value.trim();
      middle += deck ? `${name} ã•ã‚“\nã€#${deck}ã€‘\n\n` : `${name} ã•ã‚“\n\n`;
    });
  } else {
    const rankEmojis = ["ğŸ†","ğŸ¥ˆ","ğŸ¥‰","ğŸ–"];
    enteredWinners.forEach((w,i)=>{
      const name = w.name.value;
      const deck = w.deck.value.trim();
      middle += deck ? `${rankEmojis[i]} ${name} ã•ã‚“\nã€#${deck}ã€‘\n\n` : `${rankEmojis[i]} ${name} ã•ã‚“\n\n`;
    });
  }

  previewDiv.textContent = `${startTemplate}\n\n${middle}${endTemplate}`;
}

// XæŠ•ç¨¿ãƒœã‚¿ãƒ³
tweetButton.addEventListener("click", ()=>{
  const text = previewDiv.textContent.trim();
  if (!text) return alert("æŠ•ç¨¿å†…å®¹ãŒç©ºã§ã™ã€‚");
  const tweetUrl = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(text);
  window.open(tweetUrl, "_blank");
});

[eventSelect, participantsInput, formatSelect].forEach(el=>el.addEventListener("input", updatePreview));
winners.forEach(w=>{
  w.name.addEventListener("input", updatePreview);
  w.deck.addEventListener("input", updatePreview);
});

loadTemplateData();
</script>

</body>
</html>
